<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Barcelona Treasure Hunt</title>
  <link rel="stylesheet" href="style.css">
  <meta name="theme-color" content="#0ea5e9">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
  <script defer src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
</head>
<body>
  <div id="splash" class="splash">
    <div class="splash-card">
      <img src="images/icons/map.svg" class="splash-icon" alt="Map icon">
      <h1>Hunt for Secrets</h1>
      <p>Explore Barcelona with clues, photos, and geofenced check-ins. Everything runs on your device.</p>
      <button id="startBtn" class="cta">Start the Hunt</button>
      <div class="howto">
        <div class="slides">
          <div class="slide">
            <img src="images/icons/map.svg" alt="" class="howto-ic">
            <h3>Pick a clue</h3>
            <p>Read the riddle and head toward the area it hints at.</p>
          </div>
          <div class="slide">
            <img src="images/icons/camera.svg" alt="" class="howto-ic">
            <h3>Snap a photo</h3>
            <p>Take or upload a picture at the spot.</p>
          </div>
          <div class="slide">
            <img src="images/icons/trophy.svg" alt="" class="howto-ic">
            <h3>Validate & score</h3>
            <p>We check your location (and optionally objects) locally. Earn points!</p>
          </div>
        </div>
        <div class="dots" aria-label="How to play steps">
          <button class="dot" data-i="0" aria-label="Step 1"></button>
          <button class="dot" data-i="1" aria-label="Step 2"></button>
          <button class="dot" data-i="2" aria-label="Step 3"></button>
        </div>
      </div>
      <div id="quickLinksRow" style="margin-top:10px;display:flex;gap:10px;justify-content:center;flex-wrap:wrap"><a href="#" id="linkVerify" class="badge" style="text-decoration:none">Verify a Code</a><a href="#" id="linkNearby" class="badge" style="text-decoration:none">Find Nearby</a></div>
<div class="splash-badges"><a href="#verifyCard" id="verifyQuickLink" class="badge">Verify Code</a>
        <span class="badge">Client-only</span>
      </div>
    </div>
  </div>

  <header>
    <h1>üè¥‚Äç‚ò†Ô∏è Barcelona Treasure Hunt</h1>
  </header>

  <main>
    <section id="status" aria-live="polite"></section>

    <section id="controls">
      <label>
        Select clue:
        <select id="clueSelect" aria-label="Select a clue"></select>
      </label>
      <div class="hint" id="clueHint"></div>

      <div class="actions-row"><button id="showOnMap" class="ghost">Show on Map</button></div>
      <div class="capture"><canvas id="photoPreview" style="max-width:100%;border:1px dashed var(--border);border-radius:12px;display:none"></canvas>
        <input id="photoInput" type="file" accept="image/*" capture="environment" aria-label="Upload or capture photo">
        <button id="validateBtn">Validate Location</button>
      </div>

      <div class="result" id="result"></div>
    </section>

    <section id="scoreBoard">
      <h2>Score</h2>
      <p>Completed: <span id="completedCount">0</span> / <span id="totalCount">0</span></p>
      <p>Total Points: <span id="totalPoints">0</span></p>
      <button id="resetBtn">Reset Progress</button>
    </section>

    <section id="debug">
      <details>
        <summary>Debug info</summary>
        <pre id="debugPre"></pre>
      </details>
    </section>
    <section id="completeModal" class="modal" hidden>
      <div class="modal-card">
        <h3>Hunt Complete! üéâ</h3>
        <p>Here‚Äôs your shareable completion card:</p>
        <canvas id="cardCanvas" width="1080" height="1350" style="max-width:100%;border-radius:12px"></canvas>
        <div class="pref"><label><input type="checkbox" id="batterySaverToggle"> Battery saver (skip object detection)</label><br><label><input type="checkbox" id="highContrastToggle"> High contrast mode</label><br><label><input type="checkbox" id="autoFaceBlurToggle" checked> Auto-blur faces in photo preview</label><br><button id="manualBlurBtn" class="ghost">Manual blur area‚Ä¶</button><br><div class="pref-row"><button id="backupProgress" class="ghost">Backup Progress</button><button id="restoreProgress" class="ghost">Restore Progress</button></div></div><div class="actions" style="margin-top:10px;gap:8px;display:flex;flex-wrap:wrap">
          <button id="shareCard" class="primary">Share</button>
<button id="copyCardCode" class="ghost" type="button">Copy Code</button>
          <button id="copyCode" class="ghost">Copy Code</button><button id="downloadCard" class="ghost">Download</button>
          <button id="closeCard" class="ghost">Close</button>
        </div>
      </div>
    </section>
  </main>

  <footer>
    <p>All validation happens on your device. No photos are uploaded.</p>
  </footer>

  <!-- EXIF reader (CDN) -->
  <script src="https://cdn.jsdelivr.net/npm/exifr@7/dist/full.umd.min.js"></script>
  <!-- Optional: TensorFlow.js and coco-ssd for simple object checks -->
  <script defer src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.20.0/dist/tf.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/@tensorflow-models/coco-ssd@2.2.2/dist/coco-ssd.min.js"></script>

  <script src="js/app.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/@tensorflow-models/blazeface@0.1.5/dist/blazeface.min.js"></script>
</body>
</html>
